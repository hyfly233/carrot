# Carrot YARN 项目调试方法总结

## 🎯 快速开始调试

### 1. 基本环境检查

```bash
# 检查 Go 版本
go version

# 检查项目编译
make build

# 运行基本测试
go test ./...
```

### 2. 单元测试调试

```bash
# 运行所有测试并显示详细输出
go test -v ./...

# 运行特定组件测试
go test -v ./internal/resourcemanager
go test -v ./internal/nodemanager

# 运行特定测试函数
go test -v ./internal/resourcemanager -run TestResourceManagerCreation

# 运行测试并生成覆盖率报告
go test -coverprofile=out/coverage.out ./...
go tool cover -html=out/coverage.out -o out/coverage.html
```

### 3. 性能调试

```bash
# 运行基准测试
go test -bench=. -benchmem ./internal/resourcemanager
go test -bench=. -benchmem ./internal/nodemanager

# 生成 CPU 性能分析
go test -bench=. -cpuprofile=cpu.prof ./internal/resourcemanager
go tool pprof cpu.prof

# 生成内存分析
go test -bench=. -memprofile=mem.prof ./internal/resourcemanager
go tool pprof mem.prof
```

### 4. 集成测试调试

```bash
# 运行集成测试
./scripts/integration-test.sh

# 启动调试环境
./scripts/debug.sh

# 性能分析
./scripts/performance-analysis.sh
```

## 🔧 IDE 调试配置

### VS Code 调试

1. 安装 Go 扩展
2. 使用项目中的 `.vscode/launch.json` 配置
3. 设置断点
4. 按 F5 开始调试

### GoLand/IntelliJ 调试

1. 打开项目
2. 右键点击 `main.go` 文件
3. 选择 "Debug 'go build main.go'"
4. 在 Run Configuration 中设置参数

## 🛠️ 命令行调试

### 使用 Delve 调试器

```bash
# 安装 Delve
go install github.com/go-delve/delve/cmd/dlv@latest

# 调试 ResourceManager
dlv debug cmd/resourcemanager/main.go -- -port 8088

# 调试 NodeManager
dlv debug cmd/nodemanager/main.go -- -port 8042 -host localhost -rm-url http://localhost:8088

# 连接到运行中的进程
dlv attach <PID>

# 远程调试
dlv --listen=:2345 --headless=true --api-version=2 debug cmd/resourcemanager/main.go
```

### Delve 调试命令

```
(dlv) break main.main                    # 在 main 函数设置断点
(dlv) break internal/resourcemanager.(*ResourceManager).Start  # 在方法设置断点
(dlv) continue                           # 继续执行
(dlv) next                              # 下一行
(dlv) step                              # 步入
(dlv) print variable_name               # 打印变量
(dlv) locals                            # 显示局部变量
(dlv) goroutines                        # 显示 goroutine
(dlv) stack                             # 显示调用栈
```

## 📊 日志调试

### 启用详细日志

```bash
# 设置环境变量
export LOG_LEVEL=DEBUG
export CARROT_DEBUG=true

# 启动服务
./bin/resourcemanager -port 8088
./bin/nodemanager -port 8042 -host localhost -rm-url http://localhost:8088
```
