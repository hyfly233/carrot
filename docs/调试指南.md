# Carrot YARN 项目调试指南

## 目录

1. [开发环境调试](#开发环境调试)
2. [使用 Delve 调试器](#使用-delve-调试器)
3. [日志调试](#日志调试)
4. [单元测试调试](#单元测试调试)
5. [集成测试调试](#集成测试调试)
6. [性能调试](#性能调试)
7. [网络调试](#网络调试)
8. [常见问题排查](#常见问题排查)

## 开发环境调试

### 1. IDE 调试配置

#### VS Code 配置

创建 `.vscode/launch.json` 配置文件：

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Debug ResourceManager",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "program": "${workspaceFolder}/cmd/resourcemanager/main.go",
            "args": ["-port", "8088"],
            "env": {
                "LOG_LEVEL": "DEBUG"
            },
            "console": "integratedTerminal"
        },
        {
            "name": "Debug NodeManager",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "program": "${workspaceFolder}/cmd/nodemanager/main.go",
            "args": [
                "-port", "8042",
                "-host", "localhost",
                "-rm-url", "http://localhost:8088",
                "-memory", "4096",
                "-vcores", "4"
            ],
            "env": {
                "LOG_LEVEL": "DEBUG"
            },
            "console": "integratedTerminal"
        },
        {
            "name": "Debug Client",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "program": "${workspaceFolder}/cmd/client/main.go",
            "args": [
                "-rm-url", "http://localhost:8088",
                "-app-name", "debug-test",
                "-command", "echo 'Debug test'"
            ],
            "console": "integratedTerminal"
        },
        {
            "name": "Attach to Process",
            "type": "go",
            "request": "attach",
            "mode": "local",
            "processId": 0
        }
    ]
}
```

### GoLand/IntelliJ 配置

1. 右键点击 `main.go` 文件
2. 选择 "Debug 'go build main.go'"
3. 在 Run Configuration 中设置参数和环境变量

### 2. 命令行调试

#### 使用 Delve 调试器

安装 Delve：

```bash
go install github.com/go-delve/delve/cmd/dlv@latest
```

调试 ResourceManager：

```bash
# 编译并启动调试器
dlv debug cmd/resourcemanager/main.go -- -port 8088

# 在调试器中设置断点
(dlv) break main.main
(dlv) break internal/resourcemanager.(*ResourceManager).Start
(dlv) continue
```

调试 NodeManager：

```bash
dlv debug cmd/nodemanager/main.go -- -port 8042 -host localhost -rm-url http://localhost:8088
```

#### 远程调试

启动带调试监听的服务：

```bash
# ResourceManager 远程调试
dlv --listen=:2345 --headless=true --api-version=2 debug cmd/resourcemanager/main.go -- -port 8088

# 连接到远程调试会话
dlv connect :2345
```
