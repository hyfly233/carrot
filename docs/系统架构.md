# Carrot YARN ç³»ç»Ÿæ¶æ„

## ğŸ“ æ¶æ„æ¦‚è§ˆ

Carrot YARN é‡‡ç”¨åˆ†å±‚çš„å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ç³»ç»Ÿç”±å››ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šResourceManagerã€NodeManagerã€ApplicationMaster
å’Œ Clientã€‚

## ğŸ—ï¸ åˆ†å±‚æ¶æ„

### 1. å®¢æˆ·ç«¯å±‚ (Client Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   CLI Tool  â”‚  â”‚   Web UI    â”‚  â”‚  REST API   â”‚      â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚      â”‚
â”‚  â”‚ - åº”ç”¨æäº¤   â”‚  â”‚ - é›†ç¾¤ç›‘æ§   â”‚  â”‚ - ç¨‹åºé›†æˆ   â”‚     â”‚
â”‚  â”‚ - çŠ¶æ€æŸ¥è¯¢   â”‚  â”‚ - ä»»åŠ¡ç®¡ç†   â”‚  â”‚ - æ‰¹é‡æ“ä½œ   â”‚     â”‚
â”‚  â”‚ - æ—¥å¿—è·å–   â”‚  â”‚ - æ€§èƒ½åˆ†æ   â”‚  â”‚ - è‡ªåŠ¨åŒ–    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®¢æˆ·ç«¯ç»„ä»¶

- **CLI å·¥å…·**: å‘½ä»¤è¡Œæ¥å£ï¼Œæ”¯æŒåº”ç”¨æäº¤ã€çŠ¶æ€ç›‘æ§ç­‰æ“ä½œ
- **Web UI**: åŸºäº React çš„å¯è§†åŒ–ç®¡ç†ç•Œé¢
- **REST API**: RESTful API æ¥å£ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ

### 2. èµ„æºç®¡ç†å±‚ (ResourceManager Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ResourceManager Layer                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               ResourceManager                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  Core Modules                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ApplicationMgrâ”‚ â”‚ NodeManager â”‚ â”‚  Scheduler  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - åº”ç”¨ç®¡ç†   â”‚ â”‚ - èŠ‚ç‚¹æ³¨å†Œ   â”‚ â”‚ - èµ„æºè°ƒåº¦   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - ç”Ÿå‘½å‘¨æœŸ   â”‚ â”‚ - å¿ƒè·³ç›‘æ§   â”‚ â”‚ - ä»»åŠ¡åˆ†é…   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - çŠ¶æ€è·Ÿè¸ª   â”‚ â”‚ - èµ„æºè·Ÿè¸ª   â”‚ â”‚ - ç­–ç•¥æ‰§è¡Œ   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  Support Modules                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Security   â”‚ â”‚  Recovery   â”‚ â”‚   Metrics   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - è®¤è¯æˆæƒ   â”‚ â”‚ - çŠ¶æ€æ¢å¤   â”‚ â”‚ - æ€§èƒ½ç›‘æ§   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - è®¿é—®æ§åˆ¶   â”‚ â”‚ - æ•…éšœæ¢å¤   â”‚ â”‚ - å¥åº·æ£€æŸ¥   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ - å®¡è®¡æ—¥å¿—   â”‚ â”‚ - æ•°æ®å¤‡ä»½   â”‚ â”‚ - å‘Šè­¦é€šçŸ¥   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ResourceManager æ ¸å¿ƒèŒè´£

1. **åº”ç”¨ç¨‹åºç®¡ç†**: æ¥æ”¶ã€éªŒè¯å’Œè°ƒåº¦åº”ç”¨ç¨‹åº
2. **èµ„æºåˆ†é…**: æ ¹æ®è°ƒåº¦ç­–ç•¥åˆ†é…é›†ç¾¤èµ„æº
3. **èŠ‚ç‚¹ç®¡ç†**: ç›‘æ§å’Œç®¡ç†é›†ç¾¤ä¸­çš„ NodeManager
4. **å®‰å…¨æ§åˆ¶**: å®ç°è®¤è¯ã€æˆæƒå’Œè®¿é—®æ§åˆ¶

### 3. èŠ‚ç‚¹ç®¡ç†å±‚ (NodeManager Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 NodeManager Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚NodeManager 1â”‚ â”‚NodeManager 2â”‚ â”‚NodeManager Nâ”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚â”‚Container  â”‚â”‚ â”‚â”‚Container  â”‚â”‚ â”‚â”‚Container  â”‚â”‚       â”‚
â”‚  â”‚â”‚Manager    â”‚â”‚ â”‚â”‚Manager    â”‚â”‚ â”‚â”‚Manager    â”‚â”‚       â”‚
â”‚  â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚       â”‚
â”‚  â”‚â”‚- å®¹å™¨åˆ›å»º â”‚â”‚ â”‚â”‚- å®¹å™¨åˆ›å»º â”‚â”‚ â”‚â”‚- å®¹å™¨åˆ›å»º â”‚â”‚       â”‚
â”‚  â”‚â”‚- ç”Ÿå‘½å‘¨æœŸ â”‚â”‚ â”‚â”‚- ç”Ÿå‘½å‘¨æœŸ â”‚â”‚ â”‚â”‚- ç”Ÿå‘½å‘¨æœŸ â”‚â”‚       â”‚
â”‚  â”‚â”‚- çŠ¶æ€ç›‘æ§ â”‚â”‚ â”‚â”‚- çŠ¶æ€ç›‘æ§ â”‚â”‚ â”‚â”‚- çŠ¶æ€ç›‘æ§ â”‚â”‚       â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚â”‚Resource   â”‚â”‚ â”‚â”‚Resource   â”‚â”‚ â”‚â”‚Resource   â”‚â”‚       â”‚
â”‚  â”‚â”‚Monitor    â”‚â”‚ â”‚â”‚Monitor    â”‚â”‚ â”‚â”‚Monitor    â”‚â”‚       â”‚
â”‚  â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚       â”‚
â”‚  â”‚â”‚- èµ„æºç›‘æ§ â”‚â”‚ â”‚â”‚- èµ„æºç›‘æ§ â”‚â”‚ â”‚â”‚- èµ„æºç›‘æ§ â”‚â”‚       â”‚
â”‚  â”‚â”‚- æ€§èƒ½ç»Ÿè®¡ â”‚â”‚ â”‚â”‚- æ€§èƒ½ç»Ÿè®¡ â”‚â”‚ â”‚â”‚- æ€§èƒ½ç»Ÿè®¡ â”‚â”‚       â”‚
â”‚  â”‚â”‚- å¥åº·æ£€æŸ¥ â”‚â”‚ â”‚â”‚- å¥åº·æ£€æŸ¥ â”‚â”‚ â”‚â”‚- å¥åº·æ£€æŸ¥ â”‚â”‚       â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚â”‚Localizer  â”‚â”‚ â”‚â”‚Localizer  â”‚â”‚ â”‚â”‚Localizer  â”‚â”‚       â”‚
â”‚  â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚       â”‚
â”‚  â”‚â”‚- èµ„æºä¸‹è½½ â”‚â”‚ â”‚â”‚- èµ„æºä¸‹è½½ â”‚â”‚ â”‚â”‚- èµ„æºä¸‹è½½ â”‚â”‚       â”‚
â”‚  â”‚â”‚- æœ¬åœ°ç¼“å­˜ â”‚â”‚ â”‚â”‚- æœ¬åœ°ç¼“å­˜ â”‚â”‚ â”‚â”‚- æœ¬åœ°ç¼“å­˜ â”‚â”‚       â”‚
â”‚  â”‚â”‚- æ¸…ç†ç®¡ç† â”‚â”‚ â”‚â”‚- æ¸…ç†ç®¡ç† â”‚â”‚ â”‚â”‚- æ¸…ç†ç®¡ç† â”‚â”‚       â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### NodeManager æ ¸å¿ƒèŒè´£

1. **å®¹å™¨ç®¡ç†**: åˆ›å»ºã€å¯åŠ¨ã€ç›‘æ§å’Œæ¸…ç†å®¹å™¨
2. **èµ„æºç›‘æ§**: å®æ—¶ç›‘æ§èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
3. **å¿ƒè·³é€šä¿¡**: å‘ ResourceManager å‘é€çŠ¶æ€æ›´æ–°
4. **æœ¬åœ°åŒ–**: ä¸‹è½½å’Œç®¡ç†åº”ç”¨ç¨‹åºä¾èµ–

### 4. åº”ç”¨ç¨‹åºå±‚ (Application Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Application Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚    App 1    â”‚ â”‚    App 2    â”‚ â”‚    App N    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚â”‚Applicationâ”‚â”‚ â”‚â”‚Applicationâ”‚â”‚ â”‚â”‚Applicationâ”‚â”‚       â”‚
â”‚  â”‚â”‚Master     â”‚â”‚ â”‚â”‚Master     â”‚â”‚ â”‚â”‚Master     â”‚â”‚       â”‚
â”‚  â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚       â”‚
â”‚  â”‚â”‚- ä»»åŠ¡åè°ƒ â”‚â”‚ â”‚â”‚- ä»»åŠ¡åè°ƒ â”‚â”‚ â”‚â”‚- ä»»åŠ¡åè°ƒ â”‚â”‚       â”‚
â”‚  â”‚â”‚- èµ„æºè¯·æ±‚ â”‚â”‚ â”‚â”‚- èµ„æºè¯·æ±‚ â”‚â”‚ â”‚â”‚- èµ„æºè¯·æ±‚ â”‚â”‚       â”‚
â”‚  â”‚â”‚- çŠ¶æ€ç®¡ç† â”‚â”‚ â”‚â”‚- çŠ¶æ€ç®¡ç† â”‚â”‚ â”‚â”‚- çŠ¶æ€ç®¡ç† â”‚â”‚       â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚  â”‚â”‚Containers â”‚â”‚ â”‚â”‚Containers â”‚â”‚ â”‚â”‚Containers â”‚â”‚       â”‚
â”‚  â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚ â”‚â”‚           â”‚â”‚       â”‚
â”‚  â”‚â”‚ Task 1    â”‚â”‚ â”‚â”‚ Task 1    â”‚â”‚ â”‚â”‚ Task 1    â”‚â”‚       â”‚
â”‚  â”‚â”‚ Task 2    â”‚â”‚ â”‚â”‚ Task 2    â”‚â”‚ â”‚â”‚ Task 2    â”‚â”‚       â”‚
â”‚  â”‚â”‚ Task ...  â”‚â”‚ â”‚â”‚ Task ...  â”‚â”‚ â”‚â”‚ Task ...  â”‚â”‚       â”‚
â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ äº¤äº’æµç¨‹

### 1. åº”ç”¨ç¨‹åºæäº¤æµç¨‹

```mermaid
sequenceDiagram
    participant C as Client
    participant RM as ResourceManager
    participant S as Scheduler
    participant NM as NodeManager
    participant AM as ApplicationMaster

    C->>RM: 1. submitApplication()
    RM->>RM: 2. validateApplication()
    RM->>S: 3. scheduleAM()
    S->>RM: 4. allocateContainer()
    RM->>NM: 5. startContainer(AM)
    NM->>AM: 6. launchApplicationMaster()
    AM->>RM: 7. registerApplicationMaster()
    RM->>C: 8. applicationSubmitted()
```

### 2. èµ„æºåˆ†é…æµç¨‹

```mermaid
sequenceDiagram
    participant AM as ApplicationMaster
    participant RM as ResourceManager
    participant S as Scheduler
    participant NM as NodeManager

    loop å¿ƒè·³å¾ªç¯
        AM->>RM: 1. heartbeat(resourceRequests)
        RM->>S: 2. allocate(requests)
        S->>S: 3. runScheduler()
        S->>RM: 4. allocatedContainers
        RM->>AM: 5. heartbeatResponse(allocations)
        AM->>NM: 6. startContainer(tasks)
        NM->>AM: 7. containerStatus()
    end
```

### 3. èŠ‚ç‚¹å¿ƒè·³æµç¨‹

```mermaid
sequenceDiagram
    participant NM as NodeManager
    participant RM as ResourceManager
    participant NT as NodeTracker

    loop å¿ƒè·³å¾ªç¯
        NM->>RM: 1. nodeHeartbeat(status)
        RM->>NT: 2. updateNodeStatus()
        NT->>NT: 3. validateNode()
        NT->>RM: 4. nodeUpdated()
        RM->>NM: 5. heartbeatResponse(commands)
    end
```

## ğŸ“Š æ•°æ®æµæ¶æ„

### 1. æ§åˆ¶æµ

```
Client Request â†’ ResourceManager â†’ Scheduler â†’ NodeManager â†’ Container
      â†“              â†“              â†“           â†“            â†“
   Validation â†’ ApplicationMgr â†’ Allocation â†’ Launch â†’ Execution
```

### 2. æ•°æ®æµ

```
Metrics â† ResourceManager â† NodeManager â† Container Monitor
  â†“            â†“              â†“              â†“
Prometheus â†’ Grafana    â† Log Collector â† Application Logs
```

### 3. äº‹ä»¶æµ

```
Application Events â†’ EventBus â†’ Event Handlers â†’ State Transitions
Container Events   â†’    â†“    â†’ Notifications  â†’ External Systems
Node Events        â†’    â†“    â†’ Metrics       â†’ Monitoring
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. ResourceManager å†…éƒ¨æ¶æ„

```go
type ResourceManager struct {
    // æ ¸å¿ƒç®¡ç†å™¨
    applicationManager *applicationmanager.ApplicationManager
    nodeManager        *nodemanager.NodeManager
    scheduler          scheduler.Scheduler

    // æ”¯æŒæœåŠ¡
    securityManager    *security.SecurityManager
    recoveryManager    *recovery.RecoveryManager
    metricsManager     *metrics.MetricsManager

    // é€šä¿¡å±‚
    httpServer         *http.Server
    rpcServer          *grpc.Server

    // é…ç½®å’ŒçŠ¶æ€
    config             *Config
    state              *State
}
```

### 2. NodeManager å†…éƒ¨æ¶æ„

```go
type NodeManager struct {
    // æ ¸å¿ƒç®¡ç†å™¨
    containerManager   *containermanager.ContainerManager
    resourceManager    *noderesourcemanager.ResourceManager
    localizer          *localizer.Localizer

    // ç›‘æ§å’ŒçŠ¶æ€
    systemMonitor      *monitor.SystemMonitor
    statusManager      *nodestatusmanager.StatusManager

    // é€šä¿¡
    rmClient           *RMClient
    httpServer         *http.Server

    // é…ç½®
    config             *Config
}
```

### 3. è°ƒåº¦å™¨æ¶æ„

```go
type Scheduler interface {
    Schedule(requests []*ResourceRequest) []*Allocation
    GetNodes() []*NodeInfo
    GetQueues() []*QueueInfo
}

// è°ƒåº¦å™¨å®ç°
type CapacityScheduler struct {
    queues      map[string]*CapacityQueue
    nodes       map[string]*NodeInfo
    policy      *SchedulingPolicy
}

type FairScheduler struct {
    pools       map[string]*FairPool
    nodes       map[string]*NodeInfo
    policy      *FairSchedulingPolicy
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. å¹¶å‘æ¨¡å‹

```go
// ResourceManager å¹¶å‘å¤„ç†
func (rm *ResourceManager) processRequests() {
    for {
        select {
        case req := <-rm.requestChan:
            go rm.handleRequest(req)
        case <-rm.stopChan:
            return
        }
    }
}

// ä½¿ç”¨ Worker Pool å¤„ç†é«˜å¹¶å‘
type WorkerPool struct {
    workers int
    jobs    chan Job
}
```

### 2. ç¼“å­˜ç­–ç•¥

```go
// å¤šçº§ç¼“å­˜
type CacheManager struct {
    l1Cache *lru.Cache     // å†…å­˜ç¼“å­˜
    l2Cache *redis.Client  // Redis ç¼“å­˜
    l3Cache *Database      // æ•°æ®åº“
}
```

### 3. æ‰¹å¤„ç†ä¼˜åŒ–

```go
// æ‰¹é‡å¤„ç†å¿ƒè·³
func (nm *NodeManager) batchHeartbeat() {
    ticker := time.NewTicker(heartbeatInterval)
    batch := make([]*HeartbeatRequest, 0, batchSize)

    for {
        select {
        case hb := <-nm.heartbeatChan:
            batch = append(batch, hb)
            if len(batch) >= batchSize {
                nm.sendBatchHeartbeat(batch)
                batch = batch[:0]
            }
        case <-ticker.C:
            if len(batch) > 0 {
                nm.sendBatchHeartbeat(batch)
                batch = batch[:0]
            }
        }
    }
}
```

## ğŸ”’ å®‰å…¨æ¶æ„

### 1. è®¤è¯å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Authentication            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ JWT Tokens  â”‚  â”‚ LDAP/AD     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Kerberos    â”‚  â”‚ Custom Auth â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æˆæƒå±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Authorization             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ RBAC        â”‚  â”‚ Queue ACLs  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Node Access â”‚  â”‚ App Perms   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ä¼ è¾“å®‰å…¨

```go
// TLS é…ç½®
type TLSConfig struct {
    CertFile string
    KeyFile  string
    CAFile   string

    // åŒå‘è®¤è¯
    ClientAuth tls.ClientAuthType
}
```

## ğŸ“ˆ ç›‘æ§æ¶æ„

### 1. æŒ‡æ ‡æ”¶é›†

```
Application Metrics â†’ Prometheus â†’ Grafana Dashboard
Node Metrics       â†’      â†“      â†’ Alert Manager
System Metrics     â†’ Metrics API â†’ Custom Tools
```

### 2. æ—¥å¿—èšåˆ

```
Application Logs â†’ Fluentd â†’ Elasticsearch â†’ Kibana
Node Logs       â†’    â†“    â†’ Log Analysis  â†’ Alerts
System Logs     â†’ Logstash â†’ Data Storage â†’ Archive
```

### 3. åˆ†å¸ƒå¼è¿½è¸ª

```go
// OpenTracing é›†æˆ
func (rm *ResourceManager) handleRequest(ctx context.Context, req *Request) {
    span, ctx := opentracing.StartSpanFromContext(ctx, "handleRequest")
    defer span.Finish()

    // å¤„ç†è¯·æ±‚
    result, err := rm.processRequest(ctx, req)

    // è®°å½•è¿½è¸ªä¿¡æ¯
    span.SetTag("request.id", req.ID)
    span.SetTag("error", err != nil)

    return result, err
}
```

## ğŸŒ äº‘åŸç”Ÿæ¶æ„

### 1. å®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o carrot-rm cmd/resourcemanager/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
COPY --from=builder /app/carrot-rm /usr/local/bin/
ENTRYPOINT ["carrot-rm"]
```

### 2. Kubernetes é›†æˆ

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: carrot-resourcemanager
spec:
  replicas: 2
  selector:
    matchLabels:
      app: carrot-rm
  template:
    metadata:
      labels:
        app: carrot-rm
    spec:
      containers:
        - name: resourcemanager
          image: carrot/resourcemanager:latest
          ports:
            - containerPort: 8088
          env:
            - name: RM_PORT
              value: "8088"
          resources:
            requests:
              memory: "1Gi"
              cpu: "500m"
            limits:
              memory: "2Gi"
              cpu: "1000m"
```

### 3. æœåŠ¡ç½‘æ ¼

```yaml
# Istio VirtualService
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
    name: carrot-rm-vs
spec:
    hosts:
        - carrot-rm
    http:
        - route:
              - destination:
                    host: carrot-rm-service
                    port:
                        number: 8088
          fault:
              delay:
                  percentage:
                      value: 0.1
                  fixedDelay: 5s
```

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶æ¶æ„

```go
// è°ƒåº¦å™¨æ’ä»¶æ¥å£
type SchedulerPlugin interface {
    Name() string
    PreFilter(pod *Pod, nodes []*Node) *PreFilterResult
    Filter(pod *Pod, node *Node) *FilterResult
    Score(pod *Pod, node *Node) *ScoreResult
    PostFilter(pod *Pod, nodes []*Node) *PostFilterResult
}

// æ’ä»¶æ³¨å†Œ
func RegisterPlugin(name string, plugin SchedulerPlugin) {
    schedulerPlugins[name] = plugin
}
```

### 2. å­˜å‚¨æŠ½è±¡

```go
// å­˜å‚¨æ¥å£
type StateStore interface {
    Save(key string, value interface{}) error
    Load(key string, value interface{}) error
    Delete(key string) error
    List(prefix string) ([]interface{}, error)
}

// å¤šç§å®ç°
type EtcdStore struct{}
type RedisStore struct{}
type FileStore struct{}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ResourceManager å®ç°æŒ‡å—](./ResourceManagerå®ç°æŒ‡å—.md)
- [NodeManager å®ç°æŒ‡å—](./NodeManagerå®ç°æŒ‡å—.md)
- [è°ƒåº¦å™¨å®ç°æŒ‡å—](./è°ƒåº¦å™¨å®ç°æŒ‡å—.md)
- [æ€§èƒ½è°ƒä¼˜æŒ‡å—](./æ€§èƒ½è°ƒä¼˜.md)
- [å®‰å…¨é…ç½®æŒ‡å—](./å®‰å…¨é…ç½®æŒ‡å—.md)
