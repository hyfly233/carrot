# Carrot YARN å¿«é€Ÿå®‰è£…æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Carrot YARN é›†ç¾¤ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹ (5 åˆ†é’Ÿ)

### å‰ç½®è¦æ±‚

```bash
# æ£€æŸ¥ Go ç‰ˆæœ¬ (éœ€è¦ 1.24+)
go version

# æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ
uname -a

# æ£€æŸ¥å¯ç”¨ç«¯å£
netstat -tuln | grep -E ':(8088|8042|8080)'
```

### ä¸€é”®å®‰è£…è„šæœ¬

```bash
# ä¸‹è½½å¹¶è¿è¡Œå®‰è£…è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/hyfly233/carrot/main/scripts/install.sh | bash

# æˆ–è€…æ‰‹åŠ¨ä¸‹è½½
wget https://github.com/hyfly233/carrot/releases/latest/download/carrot-linux-amd64.tar.gz
tar -xzf carrot-linux-amd64.tar.gz
cd carrot
```

## ğŸ“¦ å®‰è£…æ–¹å¼

### æ–¹å¼ 1: é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ (æ¨è)

#### Linux/macOS

```bash
# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
export CARROT_VERSION="v1.0.0"
export OS="linux"  # æˆ– "darwin" (macOS)
export ARCH="amd64"

wget https://github.com/hyfly233/carrot/releases/download/${CARROT_VERSION}/carrot-${OS}-${ARCH}.tar.gz

# è§£å‹å¹¶å®‰è£…
tar -xzf carrot-${OS}-${ARCH}.tar.gz
sudo mv carrot/bin/* /usr/local/bin/

# éªŒè¯å®‰è£…
carrot-rm --version
carrot-nm --version
```

#### ä½¿ç”¨å®‰è£…è„šæœ¬

```bash
# è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿå¹¶å®‰è£…
curl -fsSL https://raw.githubusercontent.com/hyfly233/carrot/main/scripts/install.sh | bash

# æŒ‡å®šç‰ˆæœ¬å®‰è£…
curl -fsSL https://raw.githubusercontent.com/hyfly233/carrot/main/scripts/install.sh | bash -s -- --version v1.0.0

# æŒ‡å®šå®‰è£…ç›®å½•
curl -fsSL https://raw.githubusercontent.com/hyfly233/carrot/main/scripts/install.sh | bash -s -- --prefix /opt/carrot
```

### æ–¹å¼ 2: æºç ç¼–è¯‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/hyfly233/carrot.git
cd carrot

# ç¼–è¯‘æ‰€æœ‰ç»„ä»¶
make build

# æˆ–è€…åˆ†åˆ«ç¼–è¯‘
make build-rm    # ResourceManager
make build-nm    # NodeManager
make build-am    # ApplicationMaster
make build-client # Client

# å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
sudo make install
```

### æ–¹å¼ 3: Docker éƒ¨ç½²

```bash
# æ‹‰å–å®˜æ–¹é•œåƒ
docker pull carrot/resourcemanager:latest
docker pull carrot/nodemanager:latest

# ä½¿ç”¨ Docker Compose
wget https://raw.githubusercontent.com/hyfly233/carrot/main/deployments/docker/docker-compose.yml
docker-compose up -d

# éªŒè¯éƒ¨ç½²
docker-compose ps
```

### æ–¹å¼ 4: Helm éƒ¨ç½² (Kubernetes)

```bash
# æ·»åŠ  Helm ä»“åº“
helm repo add carrot https://charts.carrot.io
helm repo update

# å®‰è£… Carrot é›†ç¾¤
helm install my-carrot carrot/carrot \
  --set resourcemanager.replicas=2 \
  --set nodemanager.replicas=3

# æŸ¥çœ‹å®‰è£…çŠ¶æ€
kubectl get pods -l app.kubernetes.io/name=carrot
```

## âš™ï¸ åŸºç¡€é…ç½®

### åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºé…ç½®ç›®å½•
sudo mkdir -p /etc/carrot
sudo mkdir -p /var/log/carrot
sudo mkdir -p /var/lib/carrot

# ç”Ÿæˆé»˜è®¤é…ç½®
carrot-rm --generate-config > /etc/carrot/resourcemanager.yaml
carrot-nm --generate-config > /etc/carrot/nodemanager.yaml
```

### ResourceManager é…ç½®

```yaml
# /etc/carrot/resourcemanager.yaml
resourcemanager:
    # æœåŠ¡é…ç½®
    port: 8088
    bind_address: "0.0.0.0"

    # è°ƒåº¦å™¨é…ç½®
    scheduler:
        type: "capacity" # æ”¯æŒ: fifo, capacity, fair
        capacity:
            queues:
                - name: "default"
                  capacity: 50
                  max_capacity: 80
                - name: "high"
                  capacity: 30
                  max_capacity: 100
                - name: "low"
                  capacity: 20
                  max_capacity: 50

    # èµ„æºé…ç½®
    resources:
        minimum_allocation:
            memory: 512 # MB
            cpu: 0.5 # vCores
        maximum_allocation:
            memory: 8192 # MB
            cpu: 8 # vCores

    # å®‰å…¨é…ç½®
    security:
        enabled: false
        auth_type: "simple" # æ”¯æŒ: simple, kerberos, jwt

    # ç›‘æ§é…ç½®
    metrics:
        enabled: true
        port: 9090
        path: "/metrics"
```

### NodeManager é…ç½®

```yaml
# /etc/carrot/nodemanager.yaml
nodemanager:
    # æœåŠ¡é…ç½®
    port: 8042
    bind_address: "0.0.0.0"

    # ResourceManager è¿æ¥
    resourcemanager:
        url: "http://localhost:8088"
        heartbeat_interval: "3s"

    # èµ„æºé…ç½®
    resources:
        memory: 8192 # MB
        cpu: 4 # vCores
        disk: 102400 # MB

    # å®¹å™¨é…ç½®
    containers:
        executor: "process" # æ”¯æŒ: process, docker
        isolation: "process" # æ”¯æŒ: process, cgroups
        log_retention: "7d"
        max_containers: 100

    # æœ¬åœ°åŒ–é…ç½®
    localizer:
        cache_size: 10240 # MB
        cleanup_interval: "1h"

    # ç›‘æ§é…ç½®
    monitoring:
        enabled: true
        interval: "10s"
        metrics_port: 9091
```

## ğŸ å¯åŠ¨é›†ç¾¤

### æ–¹å¼ 1: æ‰‹åŠ¨å¯åŠ¨

```bash
# 1. å¯åŠ¨ ResourceManager
carrot-rm --config /etc/carrot/resourcemanager.yaml &

# 2. ç­‰å¾… ResourceManager å¯åŠ¨
sleep 5

# 3. å¯åŠ¨ NodeManager
carrot-nm --config /etc/carrot/nodemanager.yaml &

# 4. éªŒè¯é›†ç¾¤çŠ¶æ€
carrot-client cluster-info
```

### æ–¹å¼ 2: systemd æœåŠ¡

```bash
# åˆ›å»º systemd æœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/carrot-rm.service > /dev/null <<EOF
[Unit]
Description=Carrot ResourceManager
After=network.target

[Service]
Type=simple
User=carrot
Group=carrot
ExecStart=/usr/local/bin/carrot-rm --config /etc/carrot/resourcemanager.yaml
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

sudo tee /etc/systemd/system/carrot-nm.service > /dev/null <<EOF
[Unit]
Description=Carrot NodeManager
After=network.target carrot-rm.service

[Service]
Type=simple
User=carrot
Group=carrot
ExecStart=/usr/local/bin/carrot-nm --config /etc/carrot/nodemanager.yaml
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable carrot-rm carrot-nm
sudo systemctl start carrot-rm
sudo systemctl start carrot-nm

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status carrot-rm carrot-nm
```

### æ–¹å¼ 3: Docker Compose

```yaml
# docker-compose.yml
version: "3.8"
services:
    resourcemanager:
        image: carrot/resourcemanager:latest
        ports:
            - "8088:8088"
            - "9090:9090" # metrics
        environment:
            - RM_PORT=8088
            - RM_SCHEDULER=capacity
        volumes:
            - ./config/rm.yaml:/etc/carrot/resourcemanager.yaml
            - rm_data:/var/lib/carrot
        restart: unless-stopped

    nodemanager1:
        image: carrot/nodemanager:latest
        ports:
            - "8042:8042"
            - "9091:9091" # metrics
        environment:
            - NM_PORT=8042
            - NM_RM_URL=http://resourcemanager:8088
            - NM_MEMORY=4096
            - NM_VCORES=2
        volumes:
            - ./config/nm.yaml:/etc/carrot/nodemanager.yaml
            - nm1_data:/var/lib/carrot
        depends_on:
            - resourcemanager
        restart: unless-stopped

    nodemanager2:
        image: carrot/nodemanager:latest
        ports:
            - "8043:8042"
            - "9092:9091" # metrics
        environment:
            - NM_PORT=8042
            - NM_RM_URL=http://resourcemanager:8088
            - NM_MEMORY=4096
            - NM_VCORES=2
        volumes:
            - ./config/nm.yaml:/etc/carrot/nodemanager.yaml
            - nm2_data:/var/lib/carrot
        depends_on:
            - resourcemanager
        restart: unless-stopped

volumes:
    rm_data:
    nm1_data:
    nm2_data:
```

```bash
# å¯åŠ¨é›†ç¾¤
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢é›†ç¾¤
docker-compose down
```

## âœ… éªŒè¯å®‰è£…

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep carrot

# æ£€æŸ¥ç«¯å£
netstat -tuln | grep -E ':(8088|8042)'

# æ£€æŸ¥æ—¥å¿—
tail -f /var/log/carrot/resourcemanager.log
tail -f /var/log/carrot/nodemanager.log
```

### 2. ä½¿ç”¨ REST API

```bash
# æ£€æŸ¥ ResourceManager çŠ¶æ€
curl http://localhost:8088/ws/v1/cluster/info

# æ£€æŸ¥èŠ‚ç‚¹ä¿¡æ¯
curl http://localhost:8088/ws/v1/cluster/nodes

# æ£€æŸ¥åº”ç”¨ç¨‹åº
curl http://localhost:8088/ws/v1/cluster/apps
```

### 3. ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·

```bash
# æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯
carrot-client cluster-info

# æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨
carrot-client node list

# æŸ¥çœ‹é˜Ÿåˆ—ä¿¡æ¯
carrot-client queue list
```

### 4. æäº¤æµ‹è¯•åº”ç”¨

```bash
# æäº¤ç®€å•æµ‹è¯•åº”ç”¨
carrot-client app submit \
  --name "test-app" \
  --memory 1024 \
  --vcores 1 \
  --command "sleep 60"

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
carrot-client app list

# æŸ¥çœ‹åº”ç”¨è¯¦æƒ…
carrot-client app status <app-id>
```

## ğŸŒ Web ç•Œé¢

### è®¿é—® Web UI

```bash
# ResourceManager Web UI
open http://localhost:8088

# NodeManager Web UI
open http://localhost:8042

# ç›‘æ§é¢æ¿ (å¦‚æœå¯ç”¨)
open http://localhost:9090  # ResourceManager æŒ‡æ ‡
open http://localhost:9091  # NodeManager æŒ‡æ ‡
```

### Web UI åŠŸèƒ½

-   **é›†ç¾¤æ¦‚è§ˆ**: èµ„æºä½¿ç”¨æƒ…å†µå’ŒèŠ‚ç‚¹çŠ¶æ€
-   **åº”ç”¨ç¨‹åºç®¡ç†**: åº”ç”¨åˆ—è¡¨ã€çŠ¶æ€å’Œè¯¦æƒ…
-   **èµ„æºç›‘æ§**: å®æ—¶èµ„æºä½¿ç”¨å›¾è¡¨
-   **æ—¥å¿—æŸ¥çœ‹**: åº”ç”¨å’Œå®¹å™¨æ—¥å¿—
-   **é…ç½®ç®¡ç†**: é›†ç¾¤é…ç½®æŸ¥çœ‹å’Œä¿®æ”¹

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. ResourceManager å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :8088

# æ£€æŸ¥é…ç½®æ–‡ä»¶
carrot-rm --config /etc/carrot/resourcemanager.yaml --validate

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
carrot-rm --config /etc/carrot/resourcemanager.yaml --log-level debug
```

#### 2. NodeManager æ— æ³•è¿æ¥ ResourceManager

```bash
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
curl http://localhost:8088/ws/v1/cluster/info

# æ£€æŸ¥ NodeManager é…ç½®
grep resourcemanager /etc/carrot/nodemanager.yaml

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo iptables -L
```

#### 3. åº”ç”¨æäº¤å¤±è´¥

```bash
# æ£€æŸ¥èµ„æºæ˜¯å¦è¶³å¤Ÿ
carrot-client cluster-info

# æ£€æŸ¥é˜Ÿåˆ—é…ç½®
carrot-client queue list

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
carrot-client app submit --name test --memory 1024 --vcores 1 --verbose
```

### æ—¥å¿—é…ç½®

```yaml
# åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ—¥å¿—é…ç½®
logging:
    level: "info" # debug, info, warn, error
    format: "json" # json, text
    output: "/var/log/carrot/resourcemanager.log"
    max_size: 100 # MB
    max_backups: 5
    max_age: 30 # days
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
export CARROT_DEBUG=true
export CARROT_LOG_LEVEL=debug

# å¯åŠ¨ç»„ä»¶
carrot-rm --config /etc/carrot/resourcemanager.yaml
```

## ğŸ“ˆ æ€§èƒ½è°ƒä¼˜

### åˆå§‹è°ƒä¼˜å»ºè®®

```yaml
# ResourceManager è°ƒä¼˜
resourcemanager:
    # æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
    max_concurrent_apps: 1000
    heartbeat_interval: "3s"

    # è°ƒåº¦å™¨ä¼˜åŒ–
    scheduler:
        max_pending_requests: 1000
        allocation_timeout: "10s"

# NodeManager è°ƒä¼˜
nodemanager:
    # æé«˜å®¹å™¨å¯†åº¦
    containers:
        max_containers: 200
        memory_overhead: 384 # MB

    # ç›‘æ§ä¼˜åŒ–
    monitoring:
        interval: "5s"
        batch_size: 100
```

## ğŸ”„ å‡çº§æŒ‡å—

### æ»šåŠ¨å‡çº§

```bash
# 1. å‡çº§ NodeManager (é€ä¸ªèŠ‚ç‚¹)
sudo systemctl stop carrot-nm
sudo cp new-carrot-nm /usr/local/bin/carrot-nm
sudo systemctl start carrot-nm

# 2. å‡çº§ ResourceManager (é«˜å¯ç”¨æ¨¡å¼)
sudo systemctl stop carrot-rm-standby
sudo cp new-carrot-rm /usr/local/bin/carrot-rm
sudo systemctl start carrot-rm-standby
# åˆ‡æ¢ä¸»å¤‡...
```

## ğŸ“š ä¸‹ä¸€æ­¥

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. ğŸ“– é˜…è¯» [åŸºç¡€ä½¿ç”¨æ•™ç¨‹](./åŸºç¡€ä½¿ç”¨æ•™ç¨‹.md)
2. ğŸ—ï¸ äº†è§£ [ç³»ç»Ÿæ¶æ„](./ç³»ç»Ÿæ¶æ„.md)
3. âš™ï¸ æŸ¥çœ‹ [é…ç½®å‚è€ƒ](./é…ç½®å‚è€ƒ.md)
4. ğŸ”§ å­¦ä¹  [è°ƒè¯•æŒ‡å—](./è°ƒè¯•æŒ‡å—.md)
5. ğŸ“Š é…ç½® [ç›‘æ§å‘Šè­¦](./ç›‘æ§å‘Šè­¦.md)
